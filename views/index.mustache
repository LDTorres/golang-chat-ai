<div class="flex items-center justify-center h-screen bg-main">
    <div class="bg-sidebar p-8 rounded-xl shadow-2xl w-full max-w-md border border-white/5">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-primary mb-2">BoreDev AI</h1>
            <p class="text-secondary text-sm">Sign in to continue your journey</p>
        </div>

        <form id="loginForm" class="space-y-5">
            <div>
                <label for="email" class="block text-xs font-medium text-secondary uppercase tracking-wider mb-2">Email
                    Address</label>
                <input type="email" id="email" name="email" required placeholder="you@example.com"
                    class="block w-full px-4 py-3 bg-input border border-white/10 rounded-lg text-primary placeholder-secondary/50 focus:outline-none focus:ring-2 focus:ring-accent/50 focus:border-accent transition-all">
            </div>

            <div id="nameField" class="hidden animate-fade-in">
                <label for="name" class="block text-xs font-medium text-secondary uppercase tracking-wider mb-2">Your
                    Name</label>
                <input type="text" id="name" name="name" placeholder="How should we call you?"
                    class="block w-full px-4 py-3 bg-input border border-white/10 rounded-lg text-primary placeholder-secondary/50 focus:outline-none focus:ring-2 focus:ring-accent/50 focus:border-accent transition-all">
                <p class="text-xs text-accent mt-2">It seems you are new here. Please tell us your name.</p>
            </div>

            <button type="submit"
                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-sm font-semibold text-white bg-accent hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-main focus:ring-accent transition-all duration-200 transform hover:scale-[1.02]">
                Enter Chat
            </button>
        </form>
    </div>
</div>

<script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const nameInput = document.getElementById('name');
        const nameField = document.getElementById('nameField');

        // First try to login/create with just email (if existing) or email+name
        const payload = { email };
        if (!nameField.classList.contains('hidden') && nameInput.value) {
            payload.name = nameInput.value;
        }

        try {
            const response = await fetch('/api/v1/users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('user_id', data.ID);
                localStorage.setItem('user_email', data.email);
                localStorage.setItem('user_name', data.name);
                window.location.href = '/chat';
            } else {
                if (data.error && data.error.includes("Name is required")) {
                    // Show name field
                    nameField.classList.remove('hidden');
                    nameInput.required = true;
                    nameInput.focus();
                } else {
                    alert('Error: ' + data.error);
                }
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred');
        }
    });
</script>